<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin Dashboard | Threat Monitor</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=JetBrains+Mono:wght@500&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #0f172a; --panel: #1e293b; --text: #e2e8f0; --accent: #38bdf8; }
        body { background-color: var(--bg); color: var(--text); font-family: 'Inter', sans-serif; margin: 0; padding: 20px; }
        
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; border-bottom: 1px solid #334155; padding-bottom: 20px; }
        .logo h1 { margin: 0; font-size: 24px; color: var(--accent); letter-spacing: -1px; }
        .logo span { font-size: 14px; color: #94a3b8; font-weight: normal; margin-left: 10px; }
        .logout-btn { background: #ef4444; color: white; padding: 8px 16px; text-decoration: none; border-radius: 6px; font-size: 14px; transition: 0.2s; }
        .logout-btn:hover { background: #dc2626; }

        /* Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ© */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: var(--panel); padding: 20px; border-radius: 10px; border: 1px solid #334155; }
        .stat-card h3 { margin: 0 0 10px 0; font-size: 14px; color: #94a3b8; text-transform: uppercase; }
        .stat-card .value { font-size: 32px; font-weight: bold; color: white; }
        .stat-card.ai { border-left: 4px solid #a855f7; } /* Ø¨Ù†ÙØ³Ø¬ÙŠ Ù„Ù„Ø°ÙƒØ§Ø¡ */
        .stat-card.waf { border-left: 4px solid #ef4444; } /* Ø£Ø­Ù…Ø± Ù„Ù„Ù€ WAF */

        /* Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙˆØ§Ù„Ø³Ø¬Ù„Ø§Øª */
        .logs-panel { background: var(--panel); border-radius: 10px; border: 1px solid #334155; overflow: hidden; }
        .panel-header { padding: 20px; background: #020617; display: flex; justify-content: space-between; align-items: center; }
        table { width: 100%; border-collapse: collapse; text-align: left; }
        th { background: #0f172a; padding: 15px; font-size: 12px; text-transform: uppercase; color: #94a3b8; letter-spacing: 1px; }
        td { padding: 15px; border-bottom: 1px solid #334155; font-size: 14px; }
        tr:last-child td { border-bottom: none; }
        
        .mono { font-family: 'JetBrains Mono', monospace; color: #cbd5e1; }

        /* Ø§Ù„ØªØµÙ†ÙŠÙ Ø§Ù„Ù„ÙˆÙ†ÙŠ Ø§Ù„Ø°ÙƒÙŠ (The Magic Part) */
        .badge { padding: 4px 10px; border-radius: 20px; font-size: 12px; font-weight: 600; display: inline-block; }
        
        /* 1. Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ (Ø¨Ù†ÙØ³Ø¬ÙŠ) */
        .badge-ai { background: rgba(168, 85, 247, 0.2); color: #d8b4fe; border: 1px solid #a855f7; }
        
        /* 2. Ø§Ù„Ù‡Ø¬Ù…Ø§Øª Ø§Ù„Ù…Ø¹Ø±ÙˆÙØ© WAF (Ø£Ø­Ù…Ø±) */
        .badge-sig { background: rgba(239, 68, 68, 0.2); color: #fca5a5; border: 1px solid #ef4444; }
        
        /* 3. Ø§Ù„Ù‡Ø¬Ù…Ø§Øª Ø§Ù„Ù…Ø³Ù…ÙˆØ­Ø© (Ø£Ø®Ø¶Ø±) */
        .badge-allow { background: rgba(34, 197, 94, 0.2); color: #86efac; border: 1px solid #22c55e; }
        
        /* 4. DDoS (Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ ØºØ§Ù…Ù‚) */
        .badge-ddos { background: rgba(249, 115, 22, 0.2); color: #fdba74; border: 1px solid #f97316; }

    </style>
</head>
<body>

    <div class="header">
        <div class="logo">
            <h1>WAAP Dashboard <span>v2.0 (Hybrid Mode)</span></h1>
        </div>
        <div>
            <a href="/logs" style="color:#38bdf8; margin-right:20px; text-decoration:none;">View Full Logs</a>
            <a href="/logout" class="logout-btn">Logout</a>
        </div>
    </div>

    <div class="stats-grid">
        <div class="stat-card ai">
            <h3>AI Detections</h3>
            <div class="value">{{ stats['AI'] }}</div>
        </div>
        <div class="stat-card waf">
            <h3>WAF Blocks (SQL/XSS)</h3>
            <div class="value">{{ stats['SQLi'] + stats['XSS'] }}</div>
        </div>
        <div class="stat-card">
            <h3>DDoS Attempts</h3>
            <div class="value">{{ stats['DDoS'] }}</div>
        </div>
        <div class="stat-card">
            <h3>Total Blocked</h3>
            <div class="value" style="color: #ef4444;">{{ stats['BLOCK'] }}</div>
        </div>
    </div>

    <div class="logs-panel">
        <div class="panel-header">
            <h3>ğŸ›¡ï¸ Live Threat Monitor</h3>
        </div>
        <table>
            <thead>
                <tr>
                    <th>Time</th>
                    <th>IP Address</th>
                    <th>Detection Source (Layer)</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% for log in logs %}
                <tr>
                    <td class="mono">{{ log.time }}</td>
                    <td class="mono">{{ log.ip }}</td>
                    
                    <td>
                        {% if 'AI' in log.threat %}
                            <span class="badge badge-ai">ğŸ¤– {{ log.threat }}</span>
                        {% elif 'Signature' in log.threat or 'SQL' in log.threat or 'XSS' in log.threat or 'LFI' in log.threat %}
                            <span class="badge badge-sig">ğŸ”¥ {{ log.threat }}</span>
                        {% elif 'DDoS' in log.threat %}
                            <span class="badge badge-ddos">âš¡ {{ log.threat }}</span>
                        {% elif 'Success' in log.threat %}
                            <span class="badge badge-allow">âœ… {{ log.threat }}</span>
                        {% else %}
                            <span class="badge">{{ log.threat }}</span>
                        {% endif %}
                    </td>

                    <td>
                        {% if 'BLOCK' in log.action %}
                            <span style="color:#ef4444; font-weight:bold;">BLOCKED</span>
                        {% else %}
                            <span style="color:#22c55e; font-weight:bold;">ALLOWED</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

</body>
</html>
